<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotionMade AI ‚Äì Business Management</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: #fff;
            color: #1f2937;
            padding: 0;
            font-size: 16px;
            line-height: 1.5;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
        @media (max-width: 480px) { .container { padding: 16px; } }

        /* Header */
        header {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        .logo-wrap { display: flex; flex-direction: column; cursor: pointer; user-select: none; }
        .logo-wrap .logo { font-size: 20px; font-weight: 700; color: #2563EB; }
        .logo-wrap .sub { font-size: 12px; color: #6b7280; margin-top: 2px; }
        .header-actions { display: flex; align-items: center; gap: 12px; }

        /* Debug panel ‚Äì hidden by default */
        #uiDebugBanner {
            display: none;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin: 0 24px 20px;
            font-family: monospace;
            font-size: 12px;
        }
        #uiDebugBanner.visible { display: block; }

        /* Auth */
        .auth-section {
            background: #f9fafb;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #e5e7eb;
        }
        .auth-section input {
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 280px;
            max-width: 100%;
            margin-right: 10px;
        }
        .auth-section button {
            padding: 10px 18px;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .auth-section button:hover { background: #1d4ed8; }
        .error { color: #dc2626; margin-top: 10px; }
        .success { color: #059669; margin-top: 10px; }

        /* Pages */
        .page { display: none; }
        .page.active { display: block; }

        /* Businesses list ‚Äì cards */
        .businesses-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
        }
        .businesses-header h2 { font-size: 22px; color: #111827; font-weight: 600; }
        .btn-primary {
            padding: 10px 20px;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            font-size: 15px;
        }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary {
            padding: 8px 14px;
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-secondary:hover { background: #e5e7eb; }
        .btn-danger {
            padding: 8px 14px;
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-danger:hover { background: #fee2e2; }

        .business-cards {
            display: grid;
            gap: 16px;
        }
        .business-card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr auto auto auto auto;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        @media (max-width: 768px) {
            .business-card {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            .business-card .card-meta { grid-column: 1; }
            .business-card .card-actions { grid-column: 1; }
        }
        .business-card .card-name { font-weight: 600; font-size: 17px; color: #111827; }
        .business-card .card-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: #6b7280;
        }
        .business-card .card-meta .type { text-transform: capitalize; }
        .business-card .card-meta .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
        }
        .business-card .card-meta .dot.active { background: #22c55e; }
        .business-card .card-owner { font-size: 13px; color: #9ca3af; margin-top: 6px; }
        .business-card .card-meta .business-type-badge {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 12px;
        }
        .business-card .card-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .owner-section .new-password-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-size: 14px;
        }

        /* Tenant detail (View / Edit FAQs) */
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #2563EB;
            text-decoration: none;
            font-size: 14px;
        }
        .back-link:hover { text-decoration: underline; }
        .tenant-detail {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
        }
        .section { margin-bottom: 28px; padding-bottom: 24px; border-bottom: 1px solid #e5e7eb; }
        .section:last-child { border-bottom: none; }
        .section h2 { margin-bottom: 16px; color: #111827; font-size: 18px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; color: #374151; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
        }
        .form-group textarea { min-height: 80px; resize: vertical; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .stat-card {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
        }
        .stat-card .label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .stat-card .value { font-size: 22px; font-weight: 600; color: #111827; }
        .domains-list { list-style: none; }
        .domains-list li {
            padding: 10px 12px;
            background: #f9fafb;
            margin-bottom: 6px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Onboarding wizard */
        .wizard { max-width: 640px; margin: 0 auto; }
        .wizard-step { display: none; margin-bottom: 32px; }
        .wizard-step.active { display: block; }
        .wizard-step h3 { font-size: 18px; color: #111827; margin-bottom: 20px; }
        .wizard .form-group textarea { min-height: 72px; }
        .wizard-actions { margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap; }
        .faq-list { list-style: none; margin-top: 16px; }
        .faq-list li {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }
        .faq-list li .q { font-weight: 500; color: #111827; }
        .faq-list li .a { font-size: 14px; color: #6b7280; margin-top: 4px; }
        .faq-list li .faq-actions { display: flex; gap: 8px; }
        .faq-list li button { padding: 4px 10px; font-size: 13px; border-radius: 6px; border: none; cursor: pointer; }
        .wizard-progress { margin: 16px 0; padding: 12px; background: #eff6ff; border-radius: 8px; font-size: 14px; }
        .wizard-progress.done { background: #d1fae5; color: #065f46; }
        .temp-password-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-size: 14px;
        }
        .temp-password-box strong { display: block; margin-bottom: 8px; }
        .live-preview-box {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
        }
        .live-preview-box .preview-header {
            background: #f9fafb;
            padding: 12px 16px;
            font-weight: 500;
            color: #374151;
        }
        .live-preview-box .chat-messages {
            min-height: 200px;
            max-height: 320px;
            overflow-y: auto;
            padding: 16px;
            background: #fff;
        }
        .live-preview-box .chat-msg { margin-bottom: 12px; }
        .live-preview-box .chat-msg.user { text-align: right; }
        .live-preview-box .chat-msg .bubble {
            display: inline-block;
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 14px;
            text-align: left;
        }
        .live-preview-box .chat-msg.user .bubble { background: #2563EB; color: #fff; }
        .live-preview-box .chat-msg.bot .bubble { background: #f3f4f6; color: #1f2937; }
        .live-preview-box .chat-input-row {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid #e5e7eb;
            background: #fff;
        }
        .live-preview-box .chat-input-row input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
        }
        .live-preview-box .chat-input-row button {
            padding: 10px 18px;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .embed-code-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            position: relative;
        }
        .embed-code-box pre { font-size: 12px; white-space: pre-wrap; word-break: break-all; margin: 0; }
        .embed-code-box .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 8px 14px;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        .embed-code-box .copy-btn.copied { background: #059669; }
        .min-faq-msg { color: #b45309; font-size: 14px; margin-top: 8px; }
        @keyframes mm-spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <header>
        <div class="logo-wrap" id="logoWrap" title="Triple-click to toggle debug">
            <span class="logo">MotionMade AI</span>
            <span class="sub">Business Management</span>
        </div>
        <div class="header-actions" id="headerActions"></div>
    </header>

    <div id="uiDebugBanner">
        <div style="font-weight: bold; margin-bottom: 8px;">üîç Debug</div>
        <div>Time: <span id="debugTime">-</span> | DOM: <span id="debugDomReady">no</span> | JS: <span id="debugJsRunning">no</span></div>
        <div style="margin-top: 8px;">Last click: <span id="debugLastClick">(none)</span></div>
        <div style="margin-top: 8px;"><strong>Errors:</strong></div>
        <pre id="uiErrors" style="background: #f8f9fa; padding: 8px; border-radius: 4px; max-height: 100px; overflow-y: auto; font-size: 11px; margin-top: 4px;"></pre>
    </div>

    <div class="auth-section" id="authSection">
        <h2 style="margin-bottom: 12px;">Admin login</h2>
        <input type="password" id="adminToken" placeholder="Enter admin token" />
        <button id="loginButton">Login</button>
        <div id="authError" class="error"></div>
    </div>

    <div class="container">
        <!-- Businesses list -->
        <div class="page" id="tenantsPage">
            <div class="businesses-header">
                <h2>Businesses</h2>
                <button class="btn-primary" id="showNewBusinessButton">+ New Business</button>
            </div>
            <div class="business-cards" id="businessCards"></div>
        </div>

        <!-- Tenant detail (View / Edit FAQs) -->
        <div class="page" id="tenantDetailPage">
            <a href="#" class="back-link" id="backToListLink">‚Üê Back to All Businesses</a>
            <div class="tenant-detail" id="tenantDetail"></div>
        </div>

        <!-- Onboarding wizard (one page, 3 steps) -->
        <div class="page" id="wizardPage">
            <a href="#" class="back-link" id="backFromWizardLink">‚Üê Back to All Businesses</a>
            <div class="wizard">
                <div class="wizard-step" id="wizardStep1">
                    <h3>1. Business details</h3>
                    <div class="form-group">
                        <label>Business name</label>
                        <input type="text" id="wizBusinessName" placeholder="e.g. Mike's Plumbing" />
                        <p id="wizWidgetIdPreview" style="font-size:14px;color:#6b7280;margin-top:8px;"></p>
                    </div>
                    <div class="form-group">
                        <label>Business type</label>
                        <select id="wizBusinessType">
                            <option value="Plumber">Plumber</option>
                            <option value="Electrician">Electrician</option>
                            <option value="Cleaner">Cleaner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Owner name</label>
                        <input type="text" id="wizOwnerName" placeholder="e.g. Mike" />
                    </div>
                    <div class="form-group">
                        <label>Owner email</label>
                        <input type="email" id="wizOwnerEmail" placeholder="e.g. mike@mikesplumbing.com.au" />
                    </div>
                    <div class="form-group">
                        <label>Owner phone</label>
                        <input type="tel" id="wizOwnerPhone" placeholder="e.g. 0412 345 678" />
                    </div>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">Business ID is generated from the name (e.g. "Mike's Plumbing" ‚Üí mikes_plumbing).</p>
                    <div class="wizard-actions">
                        <button class="btn-primary" id="wizStep1Next">Next ‚Üí</button>
                    </div>
                    <div id="wizTempPasswordBox" class="temp-password-box" style="display: none;"></div>
                    <div id="wizStep1Error" class="error"></div>
                </div>

                <div class="wizard-step" id="wizardStep1b">
                    <h3>Template (optional)</h3>
                    <p id="wizTemplateIntro" style="color:#6b7280;margin-bottom:16px;"></p>
                    <div id="wizTemplateVarForm" class="form-group"></div>
                    <div class="wizard-actions">
                        <button type="button" class="btn-primary" id="wizUseTemplateBtn">Use Template</button>
                        <button type="button" class="btn-secondary" id="wizWriteOwnFaqsBtn">Write my own FAQs</button>
                    </div>
                </div>

                <div class="wizard-step" id="wizardStep2">
                    <h3>2. Add FAQs</h3>
                    <p style="color: #6b7280; margin-bottom: 16px;">Add questions and answers one at a time while you talk to the tradie.</p>
                    <div class="form-group">
                        <label>Question</label>
                        <input type="text" id="wizFaqQuestion" placeholder="e.g. What areas do you service?" />
                    </div>
                    <div class="form-group">
                        <label>Answer</label>
                        <textarea id="wizFaqAnswer" rows="3" placeholder="e.g. We cover Brisbane, Logan, and Ipswich. $30 surcharge outside Brisbane metro."></textarea>
                    </div>
                    <div class="wizard-actions">
                        <button class="btn-secondary" id="wizAddFaq">+ Add FAQ</button>
                    </div>
                    <p id="wizMinFaqMsg" class="min-faq-msg"></p>
                    <ul class="faq-list" id="wizFaqList"></ul>
                    <div class="wizard-actions" style="margin-top: 24px;">
                        <button class="btn-primary" id="wizSaveAndGoLive">Save & Go Live</button>
                    </div>
                    <div id="wizGoLiveProgress" class="wizard-progress" style="display: none;"></div>
                    <div id="wizStep2Error" class="error" style="margin-top: 12px;"></div>
                </div>

                <div class="wizard-step" id="wizardStep3">
                    <h3>3. Live preview & install</h3>
                    <p id="wizLiveTitle" style="font-weight: 500; margin-bottom: 16px;"></p>
                    <div class="live-preview-box">
                        <div class="preview-header" id="wizPreviewHeader">Get instant answers</div>
                        <div class="mm-preview-body" id="wizPreviewBody"></div>
                    </div>
                    <p style="font-size: 14px; color: #6b7280; margin: 16px 0 8px;">Test: click a suggested question, or type your own. One question ‚Üí one answer. Use "Ask another question" to start over.</p>
                    <div style="margin-top: 24px;">
                        <strong style="display: block; margin-bottom: 8px;">Option A: Simple script tag (any website)</strong>
                        <div class="embed-code-box">
                            <pre id="wizEmbedCode"></pre>
                            <button type="button" class="copy-btn" id="wizCopyEmbed">Copy</button>
                        </div>
                        <p style="font-size: 14px; color: #374151; margin-top: 10px;">Paste this before the <code>&lt;/body&gt;</code> tag on your website.</p>
                        <details style="margin-top: 16px;">
                            <summary style="cursor: pointer; font-weight: 500; color: #2563EB;">How to install</summary>
                            <ul style="margin: 12px 0 0 20px; padding: 0; font-size: 14px; color: #6b7280; line-height: 1.6;">
                                <li><strong>WordPress:</strong> Appearance ‚Üí Theme Editor ‚Üí footer.php ‚Üí paste before &lt;/body&gt;</li>
                                <li><strong>Squarespace:</strong> Settings ‚Üí Advanced ‚Üí Code Injection ‚Üí Footer ‚Üí paste</li>
                                <li><strong>Wix:</strong> Settings ‚Üí Custom Code ‚Üí Add Code ‚Üí Body End ‚Üí paste</li>
                                <li><strong>Shopify:</strong> Online Store ‚Üí Themes ‚Üí Edit Code ‚Üí theme.liquid ‚Üí paste before &lt;/body&gt;</li>
                                <li><strong>Other:</strong> Paste the code before &lt;/body&gt; in your site's HTML</li>
                            </ul>
                        </details>
                        <p style="margin-top: 16px; font-size: 14px; color: #9ca3af;">WordPress plugin ‚Äî coming soon</p>
                        <p style="font-size: 14px; color: #9ca3af;">Squarespace / Wix: Copy the code above and paste it in your site's custom code section.</p>
                    </div>
                    <div class="wizard-actions" style="margin-top: 24px;">
                        <button class="btn-secondary" id="wizBackToBusinesses">‚Üê Back to All Businesses</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/admin.js?v=1" defer></script>
</body>
</html>
